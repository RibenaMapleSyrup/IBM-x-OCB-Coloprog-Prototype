{"version":3,"file":"tooltip.js","sourceRoot":"","sources":["../src/components/tooltip.ts"],"names":[],"mappings":"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","sourcesContent":["import * as Configuration from \"../configuration\";\n\n// Carbon position service\nimport Position, { PLACEMENTS } from \"@carbon/utils-position\";\n\n// D3 Imports\nimport { select, selectAll, mouse } from \"d3-selection\";\n\nexport class ChartTooltip {\n\tcontainer: HTMLElement;\n\tpositionService: Position = new Position();\n\n\tconstructor(container: Element) {\n\t\tthis.container = container as HTMLElement;\n\t}\n\n\tgetRef = () => select(this.container).select(\"div.chart-tooltip\").node() as HTMLElement;\n\n\tpositionTooltip() {\n\t\tconst target = this.getRef();\n\t\tconst mouseRelativePos = mouse(this.container);\n\n\t\t// Find out whether tooltip should be shown on the left or right side\n\t\tconst bestPlacementOption = this.positionService.findBestPlacementAt(\n\t\t\t{\n\t\t\t\tleft: mouseRelativePos[0],\n\t\t\t\ttop: mouseRelativePos[1]\n\t\t\t},\n\t\t\ttarget,\n\t\t\t[\n\t\t\t\tPLACEMENTS.RIGHT,\n\t\t\t\tPLACEMENTS.LEFT\n\t\t\t],\n\t\t\t() => ({\n\t\t\t\twidth: this.container.offsetWidth,\n\t\t\t\theight: this.container.offsetHeight\n\t\t\t})\n\t\t);\n\n\t\tlet { magicLeft2: horizontalOffset } = Configuration.tooltip;\n\t\tif (bestPlacementOption === PLACEMENTS.LEFT) {\n\t\t\thorizontalOffset *= -1;\n\t\t}\n\n\t\t// Get coordinates to where tooltip should be positioned\n\t\tconst pos = this.positionService.findPositionAt(\n\t\t\t{\n\t\t\t\tleft: mouseRelativePos[0] + horizontalOffset,\n\t\t\t\ttop: mouseRelativePos[1]\n\t\t\t},\n\t\t\ttarget,\n\t\t\tbestPlacementOption\n\t\t);\n\n\t\tthis.positionService.setElement(target, pos);\n\t}\n\n\tshow(contentHTML) {\n\t\t// Remove existing tooltips on the page\n\t\t// TODO - Update class to not conflict with other elements on page\n\t\tselectAll(\".chart-tooltip\").remove();\n\n\t\t// Draw tooltip\n\t\tconst tooltip = select(this.container).append(\"div\")\n\t\t\t.attr(\"class\", \"tooltip chart-tooltip\");\n\n\t\t// Apply html content to the tooltip\n\t\ttooltip.append(\"div\")\n\t\t\t.attr(\"class\", \"text-box\")\n\t\t\t.html(contentHTML);\n\n\t\t// Position the tooltip\n\t\tthis.positionTooltip();\n\n\t\t// Fade in\n\t\ttooltip.style(\"opacity\", 0)\n\t\t\t.transition()\n\t\t\t.duration(Configuration.tooltip.fadeIn.duration)\n\t\t\t.style(\"opacity\", 1);\n\n\t\t// this.addEventListeners();\n\t}\n\n\thide() {\n\t\tconst tooltipRef = select(this.container).select(\"div.chart-tooltip\");\n\n\t\t// Fade out and remove\n\t\ttooltipRef.style(\"opacity\", 1)\n\t\t\t.transition()\n\t\t\t.duration(Configuration.tooltip.fadeOut.duration)\n\t\t\t.style(\"opacity\", 0)\n\t\t\t.remove();\n\n\t\tthis.removeEventLinteners();\n\t}\n\n\thandleTooltipEvents(evt: Event) {\n\t\t// If keyboard event\n\t\tif (evt[\"key\"]) {\n\t\t\tif (evt[\"key\"] === \"Escape\" || evt[\"key\"] === \"Esc\") {\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t} else {\n\t\t\tconst targetTagName = evt.target[\"tagName\"];\n\t\t\tconst targetsToBeSkipped = Configuration.options.BASE.tooltip.targetsToSkip;\n\t\t\tif (targetsToBeSkipped.indexOf(targetTagName) === -1) {\n\t\t\t\t// If mouse event\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t}\n\t}\n\n\taddEventListeners() {\n\t\tconst tooltipRef = select(this.container).select(\"div.chart-tooltip\");\n\n\t\t// Apply the event listeners to close the tooltip\n\t\t// setTimeout is there to avoid catching the click event that opened the tooltip\n\t\tsetTimeout(() => {\n\t\t\t// When ESC is pressed\n\t\t\twindow.addEventListener(\"keydown\", this.handleTooltipEvents);\n\n\t\t\t// If clicked outside\n\t\t\tthis.container.addEventListener(\"click\", this.handleTooltipEvents);\n\n\t\t\t// Stop clicking inside tooltip from bubbling up to window\n\t\t\ttooltipRef.on(\"click\", () => {\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\t\t}, 0);\n\t}\n\n\tremoveEventLinteners() {\n\t\t// Remove eventlistener to close tooltip when ESC is pressed\n\t\twindow.removeEventListener(\"keydown\", this.handleTooltipEvents);\n\n\t\t// Remove eventlistener to close tooltip when clicked outside\n\t\tthis.container.removeEventListener(\"click\", this.handleTooltipEvents);\n\t}\n}\n"]}